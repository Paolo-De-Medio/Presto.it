<!doctype html>
<html lang="en">
  <head>

    <!-- Favicon -->
    <link rel="icon" href="./media/presto.png"> 

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

    <!-- Add the slick-theme.css if you want default styling -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <!-- Add the slick-theme.css if you want default styling -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">


    <!-- Css Stylesheet -->
    <link rel="stylesheet" href="./style.css">
    
    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <title>Presto.it!</title>

  </head>
  
  <body>

    <!-- //NAVBAR -->
      <nav class="navbar navbar-expand-lg navbar-custom sticky-top">
        <div class="container-fluid">
          <a class="ps-5 navbar-brand text-white font-logo" href="./index.html"><i class="fas fa-shipping-fast pe-2 fs-3 tc-accent"></i>Presto.it</a>
          <button id="menu-btn" class="navbar-toggler navbar-button" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"><i id="menu-icon" class="mt-1 fas fa-ellipsis-v tc-accent"></i></span>
          </button>
          <div class="container-fluid d-flex justify-content-end pe-5">
              <div>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                          <li class="nav-item text-white">
                            <a class="nav-link active" aria-current="page" href="./annunci.html"><i class="fas fa-handshake tc-accent pe-2"></i>Sfoglia gli annunci</a>
                        </li>
                        <li class="nav-item text-white">
                            <a class="nav-link active" aria-current="page" href="#"><i class="fas fa-tags tc-accent pe-2"></i>Inserisci il tuo annuncio</a>
                        </li>
                        <li class="nav-item text-white">
                            <a class="nav-link" href="#"><i class="fas fa-user-plus tc-accent pe-1 pe-2"></i> Registrati</a>
                        </li>
                        <li class="nav-item text-white">
                            <a class="nav-link" href="./profilo.html"><i class="fas tc-accent fa-user-check pe-1 pe-2"></i>Accedi</a>
                        </li>
                        </ul>
                    </div>
                </div>
            </div>
            </div>
        </div>
      </nav>


<!-- FILTERS -->

<main id="sidebar">
  <div class="container">
    <div class="row">
      <div class="col-12 col-md-4 p-4 mt-5 bg-accent filter-nav-custom">
        <!-- Section: Sidebar -->
          <h2 class="tc-accent font-logo mt-3 pb-1">Ricerca:</h2>
            <!-- Section: Filters -->
            <section class="filters">
              <!-- Section: Category -->
              <section>
                <i class="fas tc-accent fa-search-dollar me-2 fs-5"></i><input id="input-text" type="text" class="mb-4 input-custom" placeholder="Cosa stai cercando?">
              </section>
              <section>
                <h6 class=" font-logo mb-2 tc-accent">Categorie:</h6>

                <div id="categoryWrapper" class="form-check mb-3">
                  <input
                    category-filter='All'
                    type="radio"
                    class="form-check-input"
                    name="category-filter"/>
                  <label class="form-check-label text-white">
                    Tutti gli annunci
                  </label>
                </div>

              <section class="mb-2 mt-3" filter="price">
                <h6 class="font-logo mt-4 mb-2 tc-accent">Prezzo:</h6>

                <form class="form-check mb-3 p-0">
                  <i class="fs-5 fas tc-accent fa-euro-sign pe-2"></i><input class="mb-2 input-custom" id="min-price"  type="text" placeholder="Min"><br>
                  <i class="fas fs-5 tc-accent fa-euro-sign pe-2"></i><input class="mb-2 input-custom" id="max-price"  type="text" placeholder="Max"><br>
                  <button type="button" id="save-price" class="btn btn-color ms-4">Vai</button>
                  <input type="reset" value="Reset" onclick="location.reload()" class="btn btn-color">
                </form>
              <!-- Sorting -->
                <div class="select-outline position-relative w-100 text-white">
                    <h6 class="font-logo mt-4 mb-2 tc-main">Ordina:</h6>
                    <i class="fs-5 fas fa-sort tc-main me-1"></i><button class="btn btn-color" id="ordine-crescente"> Crescente</button>
                    <button class="btn btn-color" id="ordine-decrescente">Decrescente</button>
                </div>
                  <!-- Sorting -->
            </section>
            <!-- Section: Price -->
          </section>
          <!-- Section: Filters -->
        <!-- Section: Sidebar -->
      </div>

      <div class="col-12 col-md-8 mb-4">
      <!-- CARD ANNUNCI -->
      <div  class="container-fluid mt-5">
        <div  class="row">
            <div id="adsWrapper">

            </div>
        </section>
                </div>
              </div>
          </div>
      </div>
    </div>
  </div>
</main>




<!-- GO UP BUTTON -->
<button onclick="topFunction()" id="myBtn" title="Go to top"><i class="fas fa-chevron-up"></i></button>

  <!-- FOOTER -->

  <footer class="footer container-fluid section-margin bg-footer">
    <div class="row">
        <div class="container-fluid bg-footer p-5">
        <div class="row footer-text">

            <div class="col-12 col-sm-8"> 
                <h3 class="tc-accent font-logo"><i class="fas fa-pepper-hot fs-1 tc-accent me-2"></i> Team DIPC(M)</h3>
                <p class="fs-5 text-white">Davide Igor Paolo Cecilia</p>
                <p class="fs-5 text-white">P.Iva 1234567890 - Cookie policy - privacy policy</p>
                <p class="text-white">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Modi sed fugit, ipsam at <br> nisi maiores quaerat reiciendis eos tenetur! Porro quidem quo.</p>
            </div>

            <div class="col-12 col-sm-4 py-3 px-3">
              <h3 class="tc-accent font-logo fs-2">Social</h3>

              <div class="fs-5 text-white">
                <div><i class="fab fa-facebook-square tc-accent fs-4 me-2 pb-2"></i>Facebook</div>
                <div><i class="fab fa-instagram tc-accent fs-4 me-2 pb-2"></i>Instagram</div>
                <div><i class="fab fa-linkedin tc-accent fs-4 me-2 pb-2"></i>LinkedIn</div>
                <div><i class="fab fa-twitter-square tc-accent fs-4 me-2 pb-2"></i>Twitter</div>
              </div> 

            </div>
        </div>
    </div>
</footer>


    <!-- MODAL -->
<div class="modal fade" id="addModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-accent">
        <h5 class="modal-title tc-main font-logo" id="addModalLabel">Annuncio</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body modal-border">
        <div class="container-fluid text-center">
          <div class="row">
            <div class="col-12">
              <div id="immagine-annuncio" class="border-solid mb-5"></div>  
            </div>
            <div class="col-12">
              <h5 id="titolo-annuncio" class="fw-bold tc-main fs-2"></h5>
              <p class="text-muted" id="categoria-annuncio"></small></p>
              <p class="tc-accent fs-3" id="prezzo-annuncio"></p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-color" data-bs-dismiss="modal">Contatta l'inserzionista</button>
      </div>
    </div>
  </div>
</div>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    <script src="./script.js"></script>

    <script>

      // FETCH JSON
      fetch('./annunci.json').then(data => data.json()).then(annunci => {
        
        // RIEMPI PAGINA ANNUNCI
        function fillPage(annunci) {
        let adsWrapper = document.querySelector('#adsWrapper')
          adsWrapper.innerHTML = ''


        annunci.forEach(annuncio => {
          let adsCard = document.createElement('div')
          adsCard.classList.add("card" , "p-3" , "mb-3" , "m-0" , "cardsAd" )

          adsCard.innerHTML = `
          
                    <div class="row d-flex align-items-center justify-content-center">
                      <div class="col-12 col-md-6">
                        <img id="img-annunci" class="img-fluid p-4" src="${annuncio.image}" alt="...">
                      </div>
                      <div class="col-12 col-md-6">
                        <div class="card-body" id-annuncio="${annuncio.id}">
                          <h5 class="tc-main fs-2 card-title fw-bold">${annuncio.name}</h5>
                          <p class="tc-accent fs-3 card-text">${annuncio.price} €</p>
                          <p class="card-text"><small class="text-muted">${annuncio.category}</small></p>
                          <button id="modal-id" type="button" class="btn btn-color" data-bs-toggle="modal" data-bs-target="#addModal">
                              Maggiori Informazioni
                            </button>

                        </div>
                      </div>
                    </div>
                  </div>

    `
    adsWrapper.appendChild(adsCard)
    fillModal()
})
}
  fillPage(annunci)


        // RIEMPI CATEGORIE
        function fillCategories() {
          let categoryWrapper = document.querySelector('#categoryWrapper')
          let categorySet = new Set ();
          let array = [];

          annunci.forEach(annuncio => {
          categorySet.add(annuncio.category)
          })

          array = Array.from(categorySet);
          
            for (let i = 0 ; i < array.length ; i++) {
              let catCard = document.createElement('div')

            catCard.innerHTML = `
                <input
                  category-filter='${array[i]}'
                  type="radio"
                  class="form-check-input"
                  name="category-filter"
                />
                <label
                  class="form-check-label text-white" 
                  for="flexRadioDefault1"
                  >${array[i]}</label
                >
                `
                categoryWrapper.appendChild(catCard)
        }}
        fillCategories()

        // RICERCA PER CATEGORIA
        function filterCategory() {
          let filters = document.querySelectorAll('[category-filter]')

              filters.forEach(filter => {
                filter.addEventListener('input' , () => {

                    let check = filter.getAttribute('category-filter')

                    let filtered;
                    if (check === 'All') {
                        filtered = annunci
                    } else {
                        filtered = annunci.filter(annuncio => annuncio.category === check)
                    }
                    fillPage(filtered)
                    // fillModal()
                })
              })}
                filterCategory()

                // RICERCA PER TESTO
                function inputSearch (){

                let inputSearch = document.querySelector('#input-text');
                

                inputSearch.addEventListener('input', () =>{
                let search = inputSearch.value.toLowerCase();

                let filtered = annunci.filter(annuncio => annuncio.name.toLowerCase().includes(search))
                fillPage(filtered) 
                
                  })   
                }
                inputSearch()


                // RICERCA PER PREZZO
                function priceSearch() {
                  let savePrice = document.querySelector('#save-price')
                  
                  savePrice.addEventListener('click' , () => {
                    let minPrice = document.querySelector('#min-price').value
                    let maxPrice = document.querySelector('#max-price').value

                      let filtered = annunci.filter(el => Number(el.price) <= Number(maxPrice)).filter(el => Number(el.price) >= Number(minPrice))
                      
                      fillPage(filtered)
                      

                    })
                  
                } 
                priceSearch()


                // ORDINA CRESCENTE-DECRESCENTE
                function sort(){

                  let crescente = document.querySelector('#ordine-crescente');
                  let decrescente = document.querySelector('#ordine-decrescente');

                  crescente.addEventListener('click', () =>{

                    let risultati = annunci.sort((a,b) => Number(a.price) - Number(b.price));

                    fillPage(risultati)
                  })

                  decrescente.addEventListener('click', () =>{

                  let risultati = annunci.sort((a,b) => Number(b.price) - Number(a.price));
                  console.log(risultati)
                  
                    fillPage(risultati)
                    fillModalSort()
                    
                  })
                  
                  }
                  sort()
    
                  // FUNZIONI MODALI

                  function fillModalSort(){

                  let button = document.querySelectorAll('[id-annuncio]');

                    for( let i=0 ; i < annunci.length; i++){
                      // ARRIVANDOCI COL RAGIONAMENTO, LA FUNZIONE FUNZIONA MA VA EVIDENTEMENTE IN CONFLITTO CON I VARI FILTRI TRANNE IL SORT. STIAMO QUINDI PRENDENDO IL CODICE DI MARCO.
                      let titolo = document.querySelector('#titolo-annuncio');
                      let categoria = document.querySelector('#categoria-annuncio');
                      let prezzo = document.querySelector('#prezzo-annuncio');
                      let immagine = document.querySelector('#immagine-annuncio');


                      button[i].addEventListener('click', () => {

                    
                      let id = button[i].getAttribute("id-annuncio");

                      if(id == annunci[i].id){

                        titolo.innerHTML = annunci[i].name
                        categoria.innerHTML = annunci[i].category
                        prezzo.innerHTML = annunci[i].price + ' €'
                        immagine.innerHTML = annunci[i].image
                      }

                      })
                  }

                  }
                  fillModalSort()



                  function fillModal() {

                  let buttons = document.querySelectorAll('[id-annuncio]')

                  buttons.forEach(button => {
                      button.addEventListener('click',() =>{
                      let id = button.getAttribute("id-annuncio")
                      // let modalAds = annunci.find(el => el.id == id)
                      let titolo= document.querySelector('#titolo-annuncio')
                      let prezzo= document.querySelector('#prezzo-annuncio')
                      let categoria = document.querySelector('#categoria-annuncio')
                      let immagine = document.querySelector('#immagine-annuncio')

                      titolo.innerHTML = annunci[id-1].name
                      prezzo.innerHTML = annunci[id-1].price + '€'
                      categoria.innerHTML = annunci[id-1].category
                      immagine.innerHTML = `<img src="${annunci[id-1].image}" alt="">`
                      
                      })
                  })
                 }
                 fillModal()


    }         

      )
      


    </script>



    
  </body>
</html>